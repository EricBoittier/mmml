Running quick scan configuration 1
Features: 64, Iterations: 2, Max Degree: 2
Running: co2_quick_f64_i2_d2
======================================================================
PhysNetJax Training - CO2 Data
======================================================================

📁 Data Files:
  Train: ../preclassified_data/energies_forces_dipoles_train.npz
  Valid: ../preclassified_data/energies_forces_dipoles_valid.npz
  Checkpoints: /scicore/home/meuwly/boitti0000/mmml/mmml/physnetjax/ckpts/co2_quick_f64_i2_d2

######################################################################
# Loading Data
######################################################################

Targets: ['energy', 'forces', 'dipole']

Energy preprocessing:
  Input unit: eV
  Subtracting atomic energies: linear_regression

Loading training data...
Loaded NPZ file: ../preclassified_data/energies_forces_dipoles_train.npz
  Structures: 8000
  Keys: ['R', 'Z', 'N', 'E', 'F', 'Dxyz', 'metadata']

  Atomic energies computed from training data:
    C (Z=6): -816396177169.1201 eV
    O (Z=8): 408198086032.3596 eV

Loading validation data...
Loaded NPZ file: ../preclassified_data/energies_forces_dipoles_valid.npz
  Structures: 1000
  Keys: ['R', 'Z', 'N', 'E', 'F', 'Dxyz', 'metadata']

📏 Resizing arrays from 60 to 3 atoms...
  R: (8000, 60, 3) → (8000, 3, 3)
  F: (8000, 60, 3) → (8000, 3, 3)
  Z: (8000, 60) → (8000, 3)

📏 Resizing arrays from 60 to 3 atoms...
  R: (1000, 60, 3) → (1000, 3, 3)
  F: (1000, 60, 3) → (1000, 3, 3)
  Z: (1000, 60) → (1000, 3)

✅ Data loaded:
  Training samples: 8000
  Validation samples: 1000
  Data keys: ['R', 'Z', 'N', 'E', 'F', 'Dxyz', 'D']
  Array shapes:
    R: (8000, 3, 3)
    Z: (8000, 3)
    E: (8000,)
    F: (8000, 3, 3)
    D: (8000, 3)
  Max atoms in data: 3

  Energy std: 1.7739 eV
  Force std: 8.3630 eV/Å

######################################################################
# Building Model
######################################################################

Model hyperparameters:
  Features: 64
  Max degree: 2
  Message passing iterations: 2
  Basis functions: 64
  Cutoff: 6.0 Å
  Residual blocks: 3
  Max atoms: 3
  ZBL repulsion: False
  Predict charges: False

✅ Model created: PhysNetJax EF

######################################################################
# Training Setup
######################################################################

Training hyperparameters:
  Batch size: 16
  Max epochs: 100
  Learning rate: 0.001
  Optimizer: amsgrad
  Schedule: constant
  Transform: reduce_on_plateau
  Objective: valid_forces_mae
  Random seed: 42

Loss weights:
  Energy: 1.0
  Forces: 50.0
  Dipole: 25.0

Data keys: ['R', 'Z', 'F', 'E', 'N', 'D', 'dst_idx', 'src_idx', 'batch_segments']

======================================================================
STARTING TRAINING
======================================================================

                                   Train Data                                   
┏━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━┓
┃ R         ┃ Z         ┃ N       ┃ E       ┃ F         ┃ Dxyz      ┃ D        ┃
┡━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━┩
│ (8000, 3, │ (8000, 3) │ (8000,) │ (8000,) │ (8000, 3, │ (8000, 3) │ (8000,   │
│ 3)        │           │         │         │ 3)        │           │ 3)       │
└───────────┴───────────┴─────────┴─────────┴───────────┴───────────┴──────────┘
                                Validation Data                                 
┏━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━┓
┃ R         ┃ Z         ┃ N       ┃ E       ┃ F         ┃ Dxyz      ┃ D        ┃
┡━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━┩
│ (1000, 3, │ (1000, 3) │ (1000,) │ (1000,) │ (1000, 3, │ (1000, 3) │ (1000,   │
│ 3)        │           │         │         │ 3)        │           │ 3)       │
└───────────┴───────────┴─────────┴─────────┴───────────┴───────────┴──────────┘
Using default (fat) batching method
Training Routine
                       .,,uod8B8bou,,.
              ..,uod8BBBBBBBBBBBBBBBBRPFT?l!i:.
         ,=m8BBBBBBBBBBBBBBBRPFT?!||||||||||||||
         !...:!TVBBBRPFT||||||||||!!^^""'   ||||
         !.......:!?|||||!!^^""'            ||||
         !.........||||                     ||||
         !.........||||  ##                 ||||
         !.........||||      PhysNet        ||||
         !.........||||      JAX            ||||
         !.........||||                     ||||
         !.........||||                     ||||
         `.........||||                    ,||||
          .;.......||||               _.-!!|||||
   .,uodWBBBBb.....||||       _.-!!|||||||||!:'
!YBBBBBBBBBBBBBBb..!|||:..-!!|||||||!iof68BBBBBb....
!..YBBBBBBBBBBBBBBb!!||||||||!iof68BBBBBBRPFT?!::   `.
!....YBBBBBBBBBBBBBBbaaitf68BBBBBBRPFT?!:::::::::     `.
!......YBBBBBBBBBBBBBBBBBBBRPFT?!::::::;:!^"`;:::       `.
!........YBBBBBBBBBBRPFT?!::::::::::^''...::::::;         iBBbo.
`..........YBRPFT?!::::::::::::::::::::::::;iof68bo.      WBBBBbo.
  `..........:::::::::::::::::::::::;iof688888888888b.     `YBBBP^'
    `........::::::::::::::::;iof688888888888888888888b.     `
      `......:::::::::;iof688888888888888888888888888888b.
        `....:::;iof688888888888888888888888888888888899fT!
          `..::!8888888888888888888888888888888899fT|!^"'
            `' !!988888888888888888888888899fT|!^"'
                `!!8888888888888888899fT|!^"'
                  `!988888888899fT|!^"'
                    `!9899fT|!^"'
                      `!^"'
DATA_PATH: /scicore/home/meuwly/boitti0000/mmml/mmml/physnetjax/data
LOGS_PATH: /scicore/home/meuwly/boitti0000/mmml/mmml/physnetjax/logs
ANALYSIS_PATH: /scicore/home/meuwly/boitti0000/mmml/mmml/physnetjax/analysis
MAIN_PATH: /scicore/home/meuwly/boitti0000/mmml/mmml/physnetjax
PYCHARMM_DIR: None
Start Time:  19:46:43
                              Optimizer Arguments                               
┏━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━┳━━━━━━┳━━━━━━━┓
┃ opti… ┃ opti… ┃ sche… ┃ sche… ┃ trans… ┃ redu… ┃ clip_… ┃ b1  ┃ b2   ┃ eps   ┃
┡━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━╇━━━━━━╇━━━━━━━┩
│ amsg… │ Grad… │ cons… │ <fun… │ reduc… │ Grad… │ 10.0   │ 0.9 │ 0.99 │ 0.001 │
│       │ chai… │       │ cons… │        │ redu… │        │     │      │       │
│       │ at    │       │ at    │        │ at    │        │     │      │       │
│       │ 0x15… │       │ 0x15… │        │ 0x15… │        │     │      │       │
│       │ upda… │       │       │        │ upda… │        │     │      │       │
│       │ chai… │       │       │        │ redu… │        │     │      │       │
│       │ at    │       │       │        │ at    │        │     │      │       │
│       │ 0x15… │       │       │        │ 0x15… │        │     │      │       │
└───────┴───────┴───────┴───────┴────────┴───────┴────────┴─────┴──────┴───────┘
                              Training Parameters                               
┏━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ energy_wei… ┃ forces_we… ┃ dipole_wei… ┃ charges_w… ┃ batch_size ┃ num_atoms ┃
┡━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ 1.0         │ 50.0       │ 25.0        │ 0.0        │ 16         │ 3         │
└─────────────┴────────────┴─────────────┴────────────┴────────────┴───────────┘
                                 Training Style                                 
┏━━━━━━━━━┳━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓
┃ restart ┃ best ┃ data_keys                                ┃ objective        ┃
┡━━━━━━━━━╇━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩
│ False   │ True │ ('R', 'Z', 'F', 'E', 'N', 'D',           │ valid_forces_mae │
│         │      │ 'dst_idx', 'src_idx', 'batch_segments')  │                  │
└─────────┴──────┴──────────────────────────────────────────┴──────────────────┘
                              Validation Batch[0]                               
┏━━━━━━┳━━━━━━┳━━━━━━┳━━━━━━┳━━━━━━┳━━━━━━┳━━━━━━┳━━━━━━━┳━━━━━━┳━━━━━━━┳━━━━━━┓
┃ R    ┃ Z    ┃ F    ┃ E    ┃ N    ┃ D    ┃ dst… ┃ src_… ┃ bat… ┃ batc… ┃ ato… ┃
┡━━━━━━╇━━━━━━╇━━━━━━╇━━━━━━╇━━━━━━╇━━━━━━╇━━━━━━╇━━━━━━━╇━━━━━━╇━━━━━━━╇━━━━━━┩
│ (48, │ (48… │ (48, │ (16, │ (16… │ (16, │ (96… │ (96,) │ (96… │ (48,) │ (48… │
│ 3)   │      │ 3)   │ 1)   │      │ 3)   │      │       │      │       │      │
└──────┴──────┴──────┴──────┴──────┴──────┴──────┴───────┴──────┴───────┴──────┘
Extra Validation Info:
Z: Array[1000, 3] i32 n=3000 (12Kb) x∈[6, 8] μ=7.333 σ=0.943 cpu:0
R: Array[1000, 3, 3] n=9000 (35Kb) x∈[-1.500, 1.500] μ=0.091 σ=0.586 cpu:0
E: Array[1000] 3.9Kb x∈[-3.496, 5.444] μ=-0.020 σ=1.777 cpu:0
N: Array[1000] i32 3.9Kb x∈[3, 3] μ=3.000 σ=0. cpu:0
F: Array[1000, 3, 3] n=9000 (35Kb) x∈[-38.830, 39.798] μ=5.298e-10 σ=8.276 cpu:0
                                                                       Model Attributes                                                                        
┏━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┓
┃ features ┃ max_degree ┃ num_iterations ┃ num_basis_functions ┃ cutoff ┃ max_atomic_number ┃ charges ┃ natoms ┃ total_charge ┃ n_res ┃ zbl   ┃ debug ┃ efa   ┃
┡━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━┩
│ 64       │ 2          │ 2              │ 64                  │ 6.0    │ 118               │ False   │ 3      │ 0.0          │ 3     │ False │ False │ False │
└──────────┴────────────┴────────────────┴─────────────────────┴────────┴───────────────────┴─────────┴────────┴──────────────┴───────┴───────┴───────┴───────┘
                          PhysNetJax Training Progress                          
┏━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━┓
┃       ┃       ┃       ┃       ┃       ┃       ┃ Train ┃ Valid ┃ Train ┃ Val… ┃
┃       ┃       ┃ Eff.  ┃ Train ┃ Valid ┃ Best  ┃ Ener… ┃ Ener… ┃ Forc… ┃ For… ┃
┃ Epoch ┃ time  ┃ LR    ┃ Loss  ┃ Loss  ┃ Loss  ┃ MAE   ┃ MAE   ┃ MAE   ┃ MAE  ┃
┡━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━┩
│  91   │ 10.86 │ Array │    3… │    0… │    0… │   15… │   14… │    2… │    … │
│       │ s     │ cpu:0 │       │       │       │       │       │       │      │
│       │       │ 0.001 │       │       │       │       │       │       │      │
│  92   │ 10.57 │ Array │    3… │    0… │    0… │   15… │   14… │    2… │    … │
│       │ s     │ cpu:0 │       │       │       │       │       │       │      │
│       │       │ 0.001 │       │       │       │       │       │       │      │
│  93   │ 10.14 │ Array │    4… │    0… │    0… │   15… │   14… │    2… │    … │
│       │ s     │ cpu:0 │       │       │       │       │       │       │      │
│       │       │ 0.001 │       │       │       │       │       │       │      │
│  94   │ 10.15 │ Array │    2… │    0… │    0… │   15… │   14… │    2… │    … │
│       │ s     │ cpu:0 │       │       │       │       │       │       │      │
│       │       │ 0.001 │       │       │       │       │       │       │      │
│  95   │ 10.34 │ Array │    3… │    0… │    0… │   15… │   14… │    2… │    … │
│       │ s     │ cpu:0 │       │       │       │       │       │       │      │
│       │       │ 0.001 │       │       │       │       │       │       │      │
│  96   │ 10.15 │ Array │    3… │    0… │    0… │   15… │   14… │    2… │    … │
│       │ s     │ cpu:0 │       │       │       │       │       │       │      │
│       │       │ 0.001 │       │       │       │       │       │       │      │
│  97   │ 10.18 │ Array │    2… │    0… │    0… │   15… │   14… │    1… │    … │
│       │ s     │ cpu:0 │       │       │       │       │       │       │      │
│       │       │ 0.001 │       │       │       │       │       │       │      │
│  98   │ 10.78 │ Array │    2… │    0… │    0… │   15… │   14… │    1… │    … │
│       │ s     │ cpu:0 │       │       │       │       │       │       │      │
│       │       │ 0.001 │       │       │       │       │       │       │      │
│  99   │ 10.52 │ Array │    3… │    0… │    0… │   15… │   14… │    2… │    … │
│       │ s     │ cpu:0 │       │       │       │       │       │       │      │
│       │       │ 0.001 │       │       │       │       │       │       │      │
│  100  │ 9.78  │ Array │    3… │    0… │    0… │   15… │   14… │    2… │    … │
│       │ s     │ cpu:0 │       │       │       │       │       │       │      │
│       │       │ 0.001 │       │       │       │       │       │       │      │
└───────┴───────┴───────┴───────┴───────┴───────┴───────┴───────┴───────┴──────┘
                                Last Checkpoint                                 
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳┓
┃ Checkpoint                                                                  ┃┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇┩
│ /scicore/home/meuwly/boitti0000/mmml/mmml/physnetjax/ckpts/co2_quick_f64_i… ││
└─────────────────────────────────────────────────────────────────────────────┴┘
======================================================================
✅ TRAINING COMPLETE!
======================================================================

Final parameters saved to: /scicore/home/meuwly/boitti0000/mmml/mmml/physnetjax/ckpts/co2_quick_f64_i2_d2

To use the trained model:
  from mmml.physnetjax.physnetjax.models.model import EF
  import pickle
  
  # Load parameters
  with open('/scicore/home/meuwly/boitti0000/mmml/mmml/physnetjax/ckpts/co2_quick_f64_i2_d2/best_params.pkl', 'rb') as f:
      params = pickle.load(f)
  
  # Create model and predict
  model = EF(...)
  E, F, D = model.apply(params, R, Z, ...)
Complete: co2_quick_f64_i2_d2
