# Git Repository Recovery Instructions

## Problem

The `git filter-branch` operation to remove large files caused repository corruption.

## Solution: Fresh Clone + Reapply Changes

### Step 1: Backup Your Current Work

```bash
# Save your important code changes
cd /home/ericb/mmml
cp -r mmml/dcmnet/dcmnet/*.py ~/backup_code/
cp -r examples/co2/*.py ~/backup_code/
cp -r examples/co2/*.md ~/backup_code/

# OR create a patch of unstaged changes
git diff > ~/my_changes.patch
```

### Step 2: Clone Fresh Repository

```bash
cd /home/ericb
mv mmml mmml_corrupted_backup
git clone https://github.com/EricBoittier/mmml.git
cd mmml
```

### Step 3: Reapply Code Changes

The important code changes to reapply:

#### A. ESP Loss Function Changes
Copy these modified files from backup:
- `mmml/dcmnet/dcmnet/loss.py`
- `mmml/dcmnet/dcmnet/training.py`
- `mmml/dcmnet/dcmnet/training_multibatch.py`
- `mmml/dcmnet/dcmnet/analysis_multibatch.py`

**OR** apply the patch:
```bash
# Key change: esp_mono_loss() now returns (loss, esp_pred, esp_target, esp_errors)
```

#### B. CO2 Example Scripts
Copy these new files from backup:
```bash
cp ~/mmml_corrupted_backup/examples/co2/*.py examples/co2/
cp ~/mmml_corrupted_backup/examples/co2/*.md examples/co2/
```

### Step 4: Update .gitignore

Add to `.gitignore`:
```
# Training data files (too large for GitHub)
examples/co2/training_data/
examples/co2/training_data_fixed/
examples/co2/charge_files/
**/training_data/*.npz
**/training_data_fixed/*.npz
```

### Step 5: Commit and Push

```bash
git add .
git commit -m "Add ESP statistics tracking and CO2 data preparation scripts

- Modified esp_mono_loss() to return ESP predictions and per-grid-point errors
- Updated training scripts to print ESP statistics (MAE, RMSE, distributions)
- Added CO2 data visualization suite (7 plots)
- Created unit validation and ASE-standard conversion scripts
- Added Multiwfn charge file merger
- Excluded large training data files from Git"

git push origin main
```

## Alternative: Simple Approach (Recommended)

If you just want to save the scripts without the full history:

```bash
# 1. Create a new branch from origin/main
cd /home/ericb/mmml_corrupted_backup
git fetch origin
git checkout -b clean-start origin/main

# 2. Copy over just the code changes (not data files)
# (They're already excluded in .gitignore)

# 3. Commit and push
git add mmml/dcmnet/dcmnet/*.py
git add examples/co2/*.py examples/co2/*.md  
git add .gitignore
git commit -m "Add ESP statistics and CO2 data preparation"
git push origin clean-start

# 4. Then merge or replace main
```

## Files to Keep (Important Code)

From `mmml/dcmnet/dcmnet/`:
- `loss.py` - Modified esp_mono_loss()
- `training.py` - Enhanced with ESP stats
- `training_multibatch.py` - Enhanced with ESP stats  
- `analysis_multibatch.py` - Updated for new loss signature

From `examples/co2/`:
- `co2data.py` - Visualization script
- `prepare_training_data.py` - Validation script
- `fix_and_split_data.py` - Main conversion script (ASE units)
- `merge_charge_files.py` - Charge merger
- All `.md` documentation files

## Files to Exclude (Large Data)

These should NOT be committed:
- `examples/co2/training_data/*.npz`
- `examples/co2/training_data_fixed/*.npz`
- `examples/co2/plots/*.png`

These are generated by the scripts and are too large for GitHub.

## Quick Recovery Commands

```bash
# Save code
cd /home/ericb
tar czf mmml_code_backup.tar.gz mmml/mmml/dcmnet/dcmnet/*.py mmml/examples/co2/*.{py,md}

# Fresh start
rm -rf mmml
git clone https://github.com/EricBoittier/mmml.git
cd mmml

# Restore code
tar xzf ../mmml_code_backup.tar.gz

# Commit
git add .gitignore mmml/dcmnet/dcmnet/*.py examples/co2/*.{py,md}
git commit -m "Add ESP statistics and data preparation scripts"
git push origin main
```

